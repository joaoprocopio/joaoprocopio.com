---
import { twMerge } from "tailwind-merge"

import type { TVariant, TAffect, TWeight } from "~/constants/typography/types"
import { VARIANT_AFFECT } from "~/constants/typography/affect"

type Props<E extends TElement = typeof DEFAULT_ELEMENT> = {
  element?: E
  variant?: TVariant
  affect?: TAffect
  class?: string
} & TElementHTMLAttributes[E]

type TElementHTMLAttributes = astroHTML.JSX.DefinedIntrinsicElements
type TElement = keyof TElementHTMLAttributes

const DEFAULT_ELEMENT = "p" as const satisfies TElement
const DEFAULT_VARIANT = "body" as const satisfies TVariant
const DEFAULT_AFFECT = "regular" as const satisfies TAffect

const VARIANT_AFFECT_CLASS = Object.fromEntries(
  Object.entries(VARIANT_AFFECT).map(([variantKey, affectObject]) => [
    variantKey,
    Object.fromEntries(
      Object.entries(affectObject).map(([affectKey, affectWeight]) => [
        affectKey,
        weightToClass(affectWeight),
      ]),
    ),
  ]),
)

function weightToClass(weight: TWeight): `font-${TWeight}` {
  switch (weight) {
    case "bold":
      return "font-bold"
    case "semibold":
      return "font-semibold"
    case "medium":
      return "font-medium"
  }
}

const {
  class: classProp,
  element: elementProp,
  variant: variantProp = DEFAULT_VARIANT,
  affect: affectProp = DEFAULT_AFFECT,
  ...astroProps
} = Astro.props

const Element: TElement = elementProp ?? DEFAULT_ELEMENT
---

<Element
  class={twMerge(VARIANT_AFFECT_CLASS[variantProp][affectProp], classProp)}
  {...astroProps}>
  <slot />
</Element>
