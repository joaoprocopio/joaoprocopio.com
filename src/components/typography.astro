---
import { VARIANT_AFFECT_WEIGHT } from "~/styles/typography/affect"
import type { TAffect, TVariant, TWeight } from "~/styles/typography/types"

type Props<E extends TElement = typeof DEFAULT_ELEMENT> = {
  element?: E
  variant?: TVariant
  affect?: TAffect
  class?: string
} & TElementHTMLAttributes[E]

type TElementHTMLAttributes = astroHTML.JSX.DefinedIntrinsicElements
type TElement = keyof TElementHTMLAttributes

const DEFAULT_ELEMENT = "p" as const satisfies TElement
const DEFAULT_VARIANT = "body" as const satisfies TVariant
const DEFAULT_AFFECT = "regular" as const satisfies TAffect

function variantToClass(variant: TVariant): string {
  switch (variant) {
    case "largeTitle":
      return "text-large-title"
    case "title1":
      return "text-title-1"
    case "title2":
      return "text-title-2"
    case "title3":
      return "text-title-3"
    case "headline":
      return "text-headline"
    case "body":
      return "text-body"
    case "callout":
      return "text-callout"
    case "subheadline":
      return "text-subheadline"
    case "footnote":
      return "text-footnote"
    case "caption1":
      return "text-caption-1"
    case "caption2":
      return "text-caption-2"
  }
}

function weightToClass(variantProp: TVariant, affectProp: TAffect): string {
  const affect = VARIANT_AFFECT_WEIGHT[variantProp] as Record<TAffect, TWeight>
  const weight = affect[affectProp]

  switch (weight) {
    case "bold":
      return "font-bold"
    case "semibold":
      return "font-semibold"
    case "medium":
      return "font-medium"
    default:
      return "font-normal"
  }
}

const {
  class: classProp,
  element: elementProp,
  variant: variantProp = DEFAULT_VARIANT,
  affect: affectProp = DEFAULT_AFFECT,
  ...astroProps
} = Astro.props

const Element: TElement = elementProp ?? DEFAULT_ELEMENT
---

<Element
  class:list={[
    variantToClass(variantProp),
    weightToClass(variantProp, affectProp),
    classProp,
  ]}
  {...astroProps}>
  <slot />
</Element>
